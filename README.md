# Recommendation_system
## Задача
1. Загрузка данных из БД в Jupyter Hub, обзор данных
2. Создание признаков и обучающей выборки. Например, могут быть использованы признаки о пользователе, тексты постов и прочие статистики
3. Тренировка модели на Jupyter Hub и оценка ее качества на валидационной выборке 
4. Сохранение модели 
5. Написание сервиса: загрузка модели -> получение признаков для модели по user_id -> предсказание постов, которые лайкнут -> возвращение ответа

## Решение
1. Загрузка данных из БД
Пользователи: Загружаем информацию о пользователях, включая их профили.
Посты: Загружаем информацию о постах, включая тексты и тематики.
Действия пользователей: Загружаем данные о действиях пользователей (просмотры, лайки) с ограничением в 5 миллионов записей для обработки.

2. Предобработка данных
Фильтрация действий: Оставляем только записи с действием 'view'.
Текстовая обработка: Применяем лемматизацию и TF-IDF векторизацию для текстов постов.
Генерация признаков: Создаем дополнительные признаки на основе TF-IDF, такие как сумма, максимум и среднее значение TF-IDF для каждого поста.

3. Кластеризация текстов
PCA: Применяем PCA для уменьшения размерности TF-IDF матрицы до 20 компонент.
K-Means: Кластеризуем тексты с использованием K-Means, создавая 15 кластеров.
Расстояния до кластеров: Вычисляем расстояния от каждого поста до центроидов кластеров.

4. Объединение данных
Объединение таблиц: Объединяем данные о действиях пользователей, постах и пользователях в один датафрейм.

5. Разделение данных
Тренировочная и тестовая выборки: Разделяем данные на тренировочную и тестовую выборки по временной отсечке '2021-12-15'.

6. Обучение моделей
Протестируем 2 модели для решения задачи: Решающее дерево и CatBoost.
Решающее дерево: Обучаем модель решающего дерева с использованием ColumnTransformer для кодирования категориальных признаков.
CatBoost: Обучаем модель CatBoost с указанием категориальных признаков.

7. Оценка моделей
ROC-AUC: Оцениваем качество моделей на тренировочной и тестовой выборках с использованием метрики ROC-AUC.
Важность признаков: Анализируем важность признаков для модели CatBoost.

8. Сервис рекомендаций
Загрузка модели и признаков: При запуске сервиса загружаем обученную модель CatBoost и необходимые признаки.
Функция рекомендаций: Реализуем функцию, которая для каждого пользователя формирует рекомендации постов на основе предсказаний модели и фильтрации уже лайкнутых постов.
FastAPI: Создаем API с эндпоинтом для получения рекомендаций постов для конкретного пользователя.
Напишем тестового пользователя в файле sh.py для проверки работы модели.

## Стек
- Python, pandas, numpy, matplotlib, scikit-learn, catboost
- SQL
- FastAPI, sqlalchemy
  
## Выводы
Качество модели: Модель CatBoost показала лучшие результаты по сравнению с решающим деревом. ROC-AUC на тестовой выборке составил 0.646.
Важность признаков: Наиболее важными признаками оказались city, age и exp_group.
Производительность: Сервис обеспечивает быстрое формирование рекомендаций (менее 0.5 секунд на запрос) при использовании менее 4 ГБ памяти.
